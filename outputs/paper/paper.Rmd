---
title: "Modelling Covid's effect on Assaults in Toronto"
subtitle: "A statistical analysis of how the rise of Covid in 2020 affected assault rates in various downtown neighborhoods in Toronto"
author: 
  "Varun Vijay"
thanks: "Code and data are available at: https://github.com/Varun1005473462/final_folder-main.git."
date: "`r format(Sys.time(), '%d %B %Y')`"
abstract: "This paper presents an analysis on the effect of Covid on assault rates in downtown Toronto neighbourhoods in 2020. The paper uses datasets obtained from opendatatoronto to show how Covid had a negative effect on crime rates. The analysis consists of using the statistical programming language R to model the data using regression and constructing various plots and graphs to visually represent the data. THe results obtained will allow us to better predict people's behavior. With the better prediction of people's behaviour, the police can better manage the public order and government will be able to make reasonable and effective policy to reduce the crime rate.\\par\\textbf {Keywords:} Covid, Assaults, Crime,Toronto neighbourhoods, residents, open data toronto"

output:
  bookdown::pdf_document2
toc: FALSE
bibliography: references.bib
---


```{r libraries, include=FALSE, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(modelsummary)
library(readr)
library(here)
library(bookdown) # Referencing and report making
library(dplyr) # Data manipulation
library(kableExtra) #Table displaying
library(ggthemes) # More plot themes
library(reshape2) # Dataframe merging
library(janitor) # Cleaning data
library(ggplot2) # To make graphs
library(modelsummary)
knitr::opts_chunk$set(echo = TRUE)
```


# 1 Introduction

After the first reported outbreak of Covid in December 2019, the entire world changed. Covid was quickly declared to be a health emergency of global concern by the World health organization in March of 2020. Governments took measures to restrict the spread of the disease such as imposing lockdowns, travel bans, restrictions on public gatherings, closing down businesses and advising people to isolate at home. Citizens of countries were essentially restricted to their homes and rarely left. Covid had a huge impact on the global economy and had restricted people's actions and movements. However, this paper wants to analyse how Covid has affected one of the most common types of crime, assaults. Assaults are often physical and in a time where physical contact is discouraged, it seems contradictory to assault someone as there is the risk you might catch covid. The question this paper seeks to answer is how the Covid pandemic had affected assault rates in various neighbourhoods in Toronto for the year 2020. 

In this paper, we use data on Covid cases and crime statistics in Toronto neighbourhoods for the year 2020 to see how the number of Covid cases in a neighbourhood had affected assualts in that neighbourhood and what factors affected the assault rate the most. We constructed a model using R in order to see how Covid can affect the assault rate in a neighborhood. We also use the dataset to construct various histograms, bar plots and summary statistics about the dataset to improve the quality of our analysis. The results obtained seem to imply that the Covid pandemic had a negative effect on assaults in 2020 as crime rates went down in most downtown neighborhoods. The results obtained contribute to our understanding of how the presence of a common threat that affects everyone such as a pandemic in this case can discourage people from criminal actions. It will allow us to improve our predictions of a person's behavior during such situations. Better predictions of people's behaviors will allow the police to better manage the public order and government to make reasonable and effective policy to reduce the crime rate

The paper first presents an overview of the datasets and the variables we will be using for this study in the data section. The model section presents the regression steps taken to generate the model that shows how Covid affects crime. The results section discusses the various conclusions we can draw from the data and the model and finally the discussion section discusses the strengths and weaknesses of the paper. Any additional details are included in the appendix.

# 2 Data

## 2.1 Data Source and collection

For the dataset, we obtain data using opendatatoronto on crime related statistics, Covid related data pertaining to Toronto neighborhoods. 


## 2.2 Data Modification




## 2.3 Data Tables


```{r table 1, echo=FALSE}
options(readr.show_col_types = FALSE)
covid_cases<-
  read_csv(here::here("inputs/data/covid_cases.csv"))
covid_cases<-
  covid_cases |>
  mutate(year=format(covid_cases$`Episode Date`,"%Y"))
covid_cases2020<-
  covid_cases |>
  filter(year == 2020)
covid_cases_gender<-covid_cases2020 %>% group_by(`Neighbourhood Name`, `Client Gender`) %>% count()
covid_cases_gender<-
  covid_cases_gender |>
  pivot_wider(names_from = `Client Gender`,values_fill =0,values_from = n)
covid_cases_outbreak<-covid_cases2020 %>% group_by(`Neighbourhood Name`,`Outbreak Associated`) %>% count()
covid_cases_outbreak<-
  covid_cases_outbreak |>
  pivot_wider(names_from = `Outbreak Associated`,values_fill =0,values_from = n)
covid_cases_final<-merge(covid_cases_gender,covid_cases_outbreak)
covid_cases_final<-
  covid_cases_final |>
  mutate(total_cases=`Outbreak Associated`+Sporadic)
colnames(covid_cases_final)[1]<-"Neighbourhood"
colnames(covid_cases_final)[2]<-"FEMALE_Covid_Cases"
colnames(covid_cases_final)[3]<-"MALE_Covid_Cases"
covid_cases_final<-na.omit(covid_cases_final)
```


```{r table 2, echo=FALSE}
neighbourhood_crime_rates<-
  read_csv(here::here("inputs/data/neighbourhood_crime_rates.csv"))
neighbourhood_crime_rates_assaults<- 
  neighbourhood_crime_rates |>
  select(Neighbourhood,
         Assault_2019,
         Assault_2020)
neighbourhood_crime_rates_assaults<-arrange(neighbourhood_crime_rates_assaults,Neighbourhood)
```


## Obtaining the final dataset.

```{r table 3, echo=FALSE, fig.cap="Final Dataset"}
covid_cases_final<-arrange(covid_cases_final,Neighbourhood)
neighbourhood_crime_rates_assaults<-arrange(neighbourhood_crime_rates_assaults,Neighbourhood)
final_dataset<-
  neighbourhood_crime_rates_assaults |>
  mutate(FEMALE_Covid_CASES=covid_cases_final$FEMALE_Covid_Cases,MALE_Covid_CASES=covid_cases_final$MALE_Covid_Cases,transgender_covid_cases=covid_cases_final$TRANSGENDER,unknown_covid_cases= covid_cases_final$UNKNOWN,other_covid_cases=covid_cases_final$OTHER, Outbreak_Associated=covid_cases_final$`Outbreak Associated`,Sporadic=covid_cases_final$Sporadic,Total_CASES=covid_cases_final$total_cases)
final_dataset
```


## 2.4 Data Visualization

```{r summary 1, echo=FALSE}
final_dataset |>
  datasummary_skim()
```

```{r summary 2,echo=FALSE}
final_dataset |>
  datasummary_correlation()
```


```{r figure 1, echo=FALSE, fig.cap="Assualts in 2020 compared to assaults in 2019"}
colors<-c("Assaults 2019"="red", "Assaults 2020"="blue")
ggplot()+
geom_point(data=final_dataset, mapping=aes(x=Neighbourhood, y=Assault_2019,color="Assaults 2019"),size=1) + 
geom_point(data=final_dataset, aes(x=Neighbourhood, y=Assault_2020,color="Assaults 2020"),size=1)+
  labs(x="Neighbourhoods",
       y="Assaults 2019, Assaults 2020",
       title="Assualts in 2020 compared to assaults in 2019")
```

```{r figure 2, echo=FALSE, fig.cap="Covid cases for each neighborhood in 2020"}
colors<-c("Female"="red", "Male"="blue", "Transgender"="purple","Unknown"="green","Other"="yellow")
ggplot()+
geom_point(data=final_dataset, mapping=aes(x=Neighbourhood, y=FEMALE_Covid_CASES,color="Female"),size=1) + 
geom_point(data=final_dataset, aes(x=Neighbourhood, y=MALE_Covid_CASES,color="Male"),size=1)+
  geom_point(data=final_dataset, aes(x=Neighbourhood, y=transgender_covid_cases,color="Transgender"),size=1)+
  geom_point(data=final_dataset, aes(x=Neighbourhood, y=unknown_covid_cases,color="Unknown"),size=1)+
  geom_point(data=final_dataset, aes(x=Neighbourhood, y=other_covid_cases,color="Other"),size=1)+
  labs(x="Neighbourhoods",
       y="Female, Male, Transgender, Unknown, Other",
       title="Covid cases by gender and neighborhood")
```







# Model



$$ y = \beta_0 +\beta_1*x_1+\beta_2*x_2  $$

y= number of assaults in a neighbourhood
x_1 = number of female covid cases in a neighbourhood
x_2 = number of male covid cases in a neighbourhood

Equation \@ref(eq:bayes) seems useful, eh?

Here's a dumb example of how to use some references: In paper we run our analysis in `R` [@citeR]. We also use the `tidyverse` which was written by @thereferencecanbewhatever If we were interested in baseball data then @citeLahman could be useful. 

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results




## Table of estimates

```{r model estimates, echo=FALSE}
Terms<-c("Intercept", "Female_covid_cases estimate", "Male_covid_cases estimate", "Number of observation", "R^2", "R^2 adjusted", "AIC", "BIC", "Log.Lik", "F")
values<-c(58.410, -1.174, 2.029, 140, 0.363, 0.354, 1698.6, 1710.3, -845.280, 39.044)
data.frame(Terms, values)
```

$$ y = 58.410	 -1.174*x_1+2.029*x_2  $$

```{r figure , echo=FALSE, fig.cap="Relationship between Covid and Assault rates in 2020"}
final_dataset |>
  ggplot(mapping = aes(x = Total_CASES, y = Assault_2020,color="")) +
  geom_point()
```



```{r, echo=FALSE}
final_dataset |>
  ggplot(aes(x = FEMALE_Covid_CASES+MALE_Covid_CASES, y = Assault_2020)) +
  geom_point() +
  geom_smooth(method = "lm",
              color = "black", 
              linetype = "dashed",
              formula = 'y ~ x') +
  labs(x = "FEMALE_Covid_CASES+MALE_Covid_CASES",
       y = "total_Crime_2020") +
  theme_classic() +
  scale_color_brewer(palette = "Set1")
```

```{r}
plot(final_model)
```


# Discussion

## First discussion point

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}

## AIC selection
```{r, echo=FALSE}
first_model <-
  lm(Assault_2020 ~FEMALE_Covid_CASES,
     data = final_dataset)
second_model <-
  lm(Assault_2020 ~ MALE_Covid_CASES,
     data = final_dataset)
third_model <-
  lm(Assault_2020 ~FEMALE_Covid_CASES+MALE_Covid_CASES,
     data = final_dataset)
fourth_model<-
  lm(Assault_2020 ~FEMALE_Covid_CASES+MALE_Covid_CASES+Sporadic,
     data = final_dataset)
fifth_model <-
  lm(Assault_2020 ~ FEMALE_Covid_CASES+MALE_Covid_CASES+Outbreak_Associated,
     data = final_dataset)
sixth_model <-
  lm(Assault_2020 ~ FEMALE_Covid_CASES+MALE_Covid_CASES+Sporadic+Outbreak_Associated,data = final_dataset)
seventh_model<-
   lm(Assault_2020 ~ Sporadic+Outbreak_Associated,data = final_dataset)
eight_model<-lm(Assault_2020 ~ 1,data = final_dataset)
ninth_model<-lm(Assault_2020~Total_CASES,data=final_dataset)
modelsummary(list(first_model,second_model,third_model,fourth_model,fifth_model,sixth_model, seventh_model,eight_model,ninth_model))
```

```{r model, echo=FALSE, message=FALSE, include=FALSE}
final_model<-lm(formula=Assault_2020~FEMALE_Covid_CASES+MALE_Covid_CASES,data=final_dataset)
modelsummary(final_model)
```




# Additional details


\newpage


# References


